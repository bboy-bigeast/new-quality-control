# 原料管理系统使用指南

## 系统概述

原料管理系统是一个基于Django框架开发的Web应用，用于管理原料的质量控制、检测标准和历史记录。系统提供了完整的原料生命周期管理功能。

## 功能特性

### 1. 原料管理
- 原料信息录入（名称、批号、供应商、检测人等）
- 质量检测数据记录（纯度、水分、外观等8个检测项目）
- 自动判定功能（基于标准自动判定原料是否合格）
- 原料详情查看和编辑

### 2. 标准管理
- 原料标准定义（外控标准、内控标准、供应商标准）
- 多维度标准设置（下限、上限、目标值）
- 标准版本管理和修改历史

### 3. 数据可视化
- 原料列表分页显示
- 标准列表筛选和搜索
- 仪表板数据统计

### 4. 权限管理
- Django Admin后台管理
- 完整的CRUD操作权限控制

## 访问地址

### Web界面
- **主页面**: http://127.0.0.1:8000/
- **原料列表**: http://127.0.0.1:8000/raw-materials/
- **原料详情**: http://127.0.0.1:8000/raw-materials/{id}/
- **标准列表**: http://127.0.0.1:8000/raw-materials/standards/
- **仪表板**: http://127.0.0.1:8000/raw-materials/dashboard/

### 管理后台
- **Admin后台**: http://127.0.0.1:8000/admin/
- 用户名/密码: 需要先创建超级用户

## 安装和配置

### 1. 环境要求
- Python 3.8+
- Django 5.2.5
- MySQL数据库

### 2. 数据库配置
系统使用MySQL数据库，配置信息在 `quality_control/settings.py`:
```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'quality_control',
        'USER': 'root',
        'PASSWORD': 'cxd951011',
        'HOST': 'localhost',
        'PORT': '3306',
        'OPTIONS': {'charset': 'utf8mb4'}
    }
}
```

### 3. 初始化步骤
```bash
# 创建数据库迁移
python manage.py makemigrations

# 应用数据库迁移
python manage.py migrate

# 创建超级用户（用于Admin后台）
python manage.py createsuperuser

# 启动开发服务器
python manage.py runserver
```

## 使用说明

### 1. 添加原料
1. 访问Admin后台或通过API添加原料
2. 填写原料基本信息（名称、批号、供应商等）
3. 填写检测数据（纯度、水分含量等）
4. 系统会自动根据标准进行判定

### 2. 设置标准
1. 在Admin后台进入"原料标准"管理
2. 选择原料名称和检测项目
3. 设置标准类型（外控/内控/供应商）
4. 定义上下限和目标值

### 3. 查看原料详情
1. 在原料列表点击查看详情
2. 查看完整的原料信息和检测结果
3. 查看自动判定结果和判定详情

### 4. 数据筛选
- 原料列表支持分页和搜索
- 标准列表支持按原料名称、标准类型筛选

## 数据模型

### RawMaterial（原料模型）
- `material_name`: 原料名称
- `material_batch`: 原料批号（唯一）
- `inspector`: 检测人
- `sample_category`: 样品类别（单批样/装车样/掺桶样）
- `test_date`: 测试日期
- `supplier`: 供应商
- 质量检测字段：纯度、水分含量、外观等8个指标
- 判定相关字段：判定状态、判定结果、判定详情

### RawMaterialStandard（标准模型）
- `material_name`: 原料名称
- `test_item`: 检测项目（外观、纯度、水分等）
- `standard_type`: 标准类型（外控、内控、供应商）
- `lower_limit`: 下限值
- `upper_limit`: 上限值
- `target_value`: 目标值

## API接口

系统提供以下RESTful API接口：

### 原料相关
- `GET /raw-materials/` - 获取原料列表
- `GET /raw-materials/{id}/` - 获取原料详情
- `POST /raw-materials/` - 创建新原料
- `PUT /raw-materials/{id}/` - 更新原料信息
- `DELETE /raw-materials/{id}/` - 删除原料

### 标准相关
- `GET /raw-materials/standards/` - 获取标准列表
- `GET /raw-materials/standards/{id}/` - 获取标准详情

## 自动判定逻辑

系统内置智能判定功能：
1. 根据原料名称查找相关标准
2. 对每个检测项目进行标准比对
3. 自动计算判定结果（合格/不合格）
4. 生成详细的判定报告

## 测试验证

系统包含完整的测试脚本：
```bash
# 运行功能测试
python test_raw_materials.py
```

测试内容包括：
- 原料创建和标准创建
- URL路由配置验证
- Admin注册检查
- 自动判定功能测试

## 故障排除

### 常见问题
1. **数据库连接失败**: 检查MySQL服务是否启动，数据库配置是否正确
2. **迁移失败**: 删除 migrations 目录下的文件（除了 __init__.py），重新运行 makemigrations
3. **静态文件404**: 运行 `python manage.py collectstatic`

### 日志查看
- Django开发服务器会输出详细的请求日志
- 查看控制台输出获取错误信息

## 扩展开发

### 添加新功能
1. 在 `raw_materials/models.py` 中添加新模型
2. 在 `raw_materials/admin.py` 中注册Admin
3. 在 `raw_materials/views.py` 中添加视图
4. 在 `raw_materials/urls.py` 中配置路由
5. 创建对应的模板文件

### 自定义判定逻辑
修改 `RawMaterial.calculate_judgment()` 方法来自定义判定算法。

## 技术支持

如有问题请联系系统管理员或查看Django官方文档。
